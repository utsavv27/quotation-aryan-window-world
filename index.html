<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aryan Window World - Quotation Generator</title>
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #144B8C 0%, #2563eb 50%, #1e40af 100%);
      min-height: 100vh;
      padding: 15px;
      color: #333;
    }

    .top-bar {
      background: rgba(255, 255, 255, 0.95);
      padding: 12px 20px;
      border-radius: 12px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 10px 25px rgba(20, 75, 140, 0.15);
      flex-wrap: wrap;
      gap: 10px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #374151;
      font-weight: 600;
      font-size: 14px;
    }

    .user-info i {
      color: #144B8C;
      font-size: 16px;
    }

    .btn-logout {
      background: linear-gradient(135deg, #dc2626, #ef4444);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s ease;
    }

    .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
    }

    .main-header {
      text-align: center;
      margin-bottom: 30px;
      background: rgba(255, 255, 255, 0.95);
      padding: 25px 20px;
      border-radius: 20px;
      backdrop-filter: blur(15px);
      box-shadow: 0 20px 40px rgba(20, 75, 140, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .logo {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #144B8C, #1e40af);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
      box-shadow: 0 10px 20px rgba(20, 75, 140, 0.3);
      flex-shrink: 0;
    }

    .company-name {
      font-size: clamp(20px, 4vw, 28px);
      font-weight: 800;
      background: linear-gradient(135deg, #144B8C, #1e40af);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1.2;
    }

    .tagline {
      font-size: clamp(12px, 2.5vw, 14px);
      color: #666;
      font-weight: 500;
      margin-top: 5px;
    }

    h2 {
      font-size: clamp(14px, 3vw, 16px);
      margin-bottom: 20px;
      color: #144B8C;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    h2::before {
      content: '';
      width: 4px;
      height: 20px;
      background: linear-gradient(135deg, #144B8C, #1e40af);
      border-radius: 2px;
      flex-shrink: 0;
    }

    h3,
    h4 {
      margin-bottom: 15px;
      font-weight: 600;
      color: #374151;
      font-size: clamp(12px, 2.5vw, 14px);
    }

    .form-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      padding: clamp(15px, 3vw, 25px);
      margin-bottom: 20px;
      box-shadow: 0 15px 35px rgba(20, 75, 140, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(250px, 100%), 1fr));
      gap: clamp(10px, 2vw, 15px);
      margin-bottom: 20px;
    }

    .grid-item {
      display: flex;
      flex-direction: column;
      min-width: 0;
    }

    .grid-item label {
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
      font-size: clamp(11px, 2.2vw, 13px);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .grid-item label i {
      font-size: clamp(10px, 2vw, 12px);
      color: #144B8C;
    }

    input,
    textarea,
    select {
      padding: clamp(10px, 2vw, 12px) clamp(12px, 2.5vw, 14px);
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: clamp(12px, 2.5vw, 14px);
      font-family: 'Inter', sans-serif;
      transition: all 0.3s ease;
      background: white;
      width: 100%;
    }

    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #144B8C;
      box-shadow: 0 0 0 3px rgba(20, 75, 140, 0.1);
      transform: translateY(-1px);
    }

    textarea {
      resize: vertical;
      min-height: clamp(60px, 10vw, 70px);
    }

    .price-preview {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border: 2px solid #fbbf24;
      border-radius: 12px;
      padding: 15px;
      margin: 20px 0;
      text-align: center;
      animation: pulse 2s ease-in-out infinite;
    }

    .price-preview-label {
      font-size: 14px;
      color: #92400e;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .price-preview-amount {
      font-size: 28px;
      font-weight: 800;
      color: #b45309;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.02); }
    }

    .btn {
      background: linear-gradient(135deg, #144B8C, #1e40af);
      color: #fff;
      padding: clamp(10px, 2.5vw, 12px) clamp(18px, 4vw, 24px);
      font-weight: 600;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 6px 6px 6px 0;
      font-size: clamp(11px, 2.2vw, 13px);
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-height: 44px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(20, 75, 140, 0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #059669, #10b981);
    }

    .btn-secondary:hover {
      box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, #dc2626, #ef4444);
      padding: clamp(8px, 2vw, 10px) clamp(12px, 3vw, 16px);
      font-size: clamp(10px, 2vw, 12px);
      min-height: 36px;
    }

    .btn-danger:hover {
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.3);
    }

    .btn-add-field {
      background: linear-gradient(135deg, #7c3aed, #8b5cf6);
    }

    .btn-add-field:hover {
      box-shadow: 0 10px 25px rgba(124, 58, 237, 0.3);
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 20px 0;
      padding: clamp(12px, 2.5vw, 15px);
      background: #f8fafc;
      border-radius: 10px;
      border: 1px solid #e2e8f0;
    }

    .checkbox-container input[type="checkbox"] {
      width: clamp(16px, 3vw, 18px);
      height: clamp(16px, 3vw, 18px);
      accent-color: #144B8C;
      flex-shrink: 0;
    }

    .checkbox-container label {
      font-weight: 500;
      color: #374151;
      cursor: pointer;
      font-size: clamp(12px, 2.5vw, 14px);
    }

    .custom-field-item {
      background: #f0f9ff;
      border: 2px solid #bae6fd;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
      position: relative;
      animation: slideIn 0.3s ease;
    }

    .custom-field-item h4 {
      color: #0369a1;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .custom-field-item .btn-danger {
      margin: 0;
    }

    .frame-sash-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(300px, 100%), 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .pdf-container {
      background: #fff;
      width: 100%;
      max-width: min(800px, 100vw - 30px);
      min-height: 297mm;
      padding: clamp(10px, 3vw, 15px);
      margin: auto;
      border-radius: 16px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
      color: #111827;
      position: relative;
      overflow-x: auto;
    }

    .pdf-header {
      text-align: center;
      margin-bottom: clamp(20px, 4vw, 25px);
      border-bottom: 4px solid #083060;
      padding-bottom: clamp(12px, 2.5vw, 15px);
    }

    .pdf-logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: clamp(10px, 3vw, 15px);
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .pdf-logo {
      width: clamp(40px, 8vw, 50px);
      height: clamp(40px, 8vw, 50px);
      background: linear-gradient(135deg, #104A8C);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: clamp(16px, 3.5vw, 20px);
      font-weight: bold;
      flex-shrink: 0;
    }

    .pdf-header h1 {
      font-size: clamp(20px, 4.5vw, 26px);
      font-weight: 800;
      margin-bottom: 8px;
      color: #1f2937;
    }

    .pdf-header .header-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      font-size: clamp(11px, 2.2vw, 13px);
      color: #6b7280;
      flex-wrap: wrap;
      gap: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: clamp(9px, 2vw, 11px);
      margin-bottom: 20px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
      display: block;
      white-space: nowrap;
    }

    table thead,
    table tbody,
    table tr {
      display: table;
      width: 100%;
      table-layout: fixed;
    }

    table th,
    table td {
      border: 1px solid #d1d5db;
      padding: clamp(6px, 1.5vw, 10px) clamp(4px, 1vw, 8px);
      text-align: center;
      vertical-align: top;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    table th {
      background: linear-gradient(135deg, #144B8C, #1e40af);
      color: #fff;
      font-weight: 600;
      font-size: clamp(8px, 1.8vw, 11px);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    table tr:nth-child(even) td {
      background: #f8fafc;
    }

    table tr:hover td {
      background: #e2e8f0;
    }

    .totals td {
      text-align: right;
      font-weight: 500;
      font-size: clamp(10px, 2.2vw, 12px);
    }

    .grand-total td {
      font-weight: 700;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: white;
      font-size: clamp(10px, 2.5vw, 12px);
    }

    .section {
      margin-bottom: clamp(15px, 3vw, 20px);
    }

    .section h2 {
      color: #1f2937;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }

    .customer-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(min(200px, 100%), 1fr));
      gap: clamp(10px, 2.5vw, 15px);
      margin-bottom: 15px;
    }

    .info-item {
      padding: clamp(8px, 2vw, 10px);
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #144B8C;
    }

    .info-item strong {
      color: #374151;
      font-weight: 600;
      font-size: clamp(11px, 2.2vw, 12px);
    }

    .terms-list {
      font-size: clamp(8px, 1.8vw, 10px);
      line-height: 1.6;
      color: #4b5563;
      padding-left: 0;
    }

    .terms-list li {
      margin-bottom: 6px;
      padding-left: clamp(12px, 2.5vw, 16px);
      position: relative;
      list-style: none;
    }

    .terms-list li::before {
      content: '•';
      color: #144B8C;
      font-weight: bold;
      position: absolute;
      left: 0;
      top: 0;
    }

    footer {
      text-align: center;
      font-size: clamp(9px, 2vw, 11px);
      margin-top: clamp(25px, 5vw, 30px);
      border-top: 2px solid #e5e7eb;
      padding-top: clamp(12px, 2.5vw, 15px);
      color: #6b7280;
      font-weight: 500;
    }

    @media (min-width: 769px) {
      table th:nth-child(1), table td:nth-child(1) { width: 7%; }
      table th:nth-child(2), table td:nth-child(2) { width: 40%; text-align: left; }
      table th:nth-child(3), table td:nth-child(3) { width: 12%; }
      table th:nth-child(4), table td:nth-child(4) { width: 10%; }
      table th:nth-child(5), table td:nth-child(5) { width: 6%; }
      table th:nth-child(6), table td:nth-child(6) { width: 14%; }
      table th:nth-child(7), table td:nth-child(7) { width: 14%; }
    }

    @media (max-width: 768px) {
      body { padding: 10px; }
      .main-header { padding: 20px 15px; margin-bottom: 20px; }
      .logo-container { gap: 12px; }
      .logo { width: 50px; height: 50px; font-size: 20px; }
      .grid-container { grid-template-columns: 1fr; gap: 12px; }
      .customer-info-grid { grid-template-columns: 1fr; gap: 12px; }
      .pdf-header .header-info { flex-direction: column; gap: 8px; align-items: center; }
      .form-section { padding: 15px; margin-bottom: 15px; }
      .pdf-container { padding: 12px; margin: 10px auto; border-radius: 12px; }
      .btn { width: 100%; margin: 5px 0; justify-content: center; padding: 12px 20px; }
      .checkbox-container { padding: 12px; gap: 10px; }
      .frame-sash-grid { grid-template-columns: 1fr; }
      table { font-size: 9px; display: block; overflow-x: auto; white-space: nowrap; }
      table th, table td { padding: 6px 4px; min-width: 60px; }
      table th:nth-child(1), table td:nth-child(1) { width: 5%; }
      table th:nth-child(2), table td:nth-child(2) { width: 45%; text-align: left; }
      table th:nth-child(3), table td:nth-child(3) { width: 12%; }
      table th:nth-child(4), table td:nth-child(4) { width: 10%; }
      table th:nth-child(5), table td:nth-child(5) { width: 5%; }
      table th:nth-child(6), table td:nth-child(6) { width: 11%; }
      table th:nth-child(7), table td:nth-child(7) { width: 12%; }
    }

    @media print {
      body { background: white; padding: 0; }
      .form-section:not(#quotation) { display: none; }
      .main-header { display: none; }
      .top-bar { display: none; }
      .pdf-container { box-shadow: none; border-radius: 0; max-width: none; width: 100%; margin: 0; padding: 15mm; }
      table { font-size: 10px; display: table; white-space: normal; }
    }
  </style>
</head>

<body>
  <div class="top-bar">
    <div class="user-info">
      <i class="fas fa-user-circle"></i>
      <span>Welcome, <strong id="displayUsername"></strong></span>
    </div>
    <button class="btn-logout" onclick="handleLogout()">
      <i class="fas fa-sign-out-alt"></i>
      <span>Logout</span>
    </button>
  </div>

  <div class="main-header fade-in">
    <div class="logo-container">
      <div>
        <div>
          <img src="aryan.png" alt="Aryan Window World" style="max-width: 160px; height: auto;">
        </div>
        <div class="tagline">Premium Windows, Doors & Aluminum Solutions</div>
      </div>
    </div>
  </div>

  <div class="form-section fade-in">
    <h2><i class="fas fa-user"></i> Customer Information</h2>
    <div class="grid-container">
      <div class="grid-item">
        <label><i class="fas fa-user-circle"></i> Customer Name</label>
        <input type="text" id="custName" placeholder="Enter customer name">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-building"></i> Project Name</label>
        <input type="text" id="projectName" placeholder="Enter project name">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-calendar"></i> Quotation Date</label>
        <input type="text" id="quotationDate">
      </div>
    </div>
  </div>

  <div class="form-section fade-in">
    <h2><i class="fas fa-tools"></i> Add Product Details</h2>

    <div class="grid-container">
      <div class="grid-item">
        <label><i class="fas fa-list"></i> Product Category</label>
        <select id="productCategory">
          <option value="">Select Category</option>
          <option value="Windows">Windows</option>
          <option value="Doors">Doors</option>
          <option value="Grills">Grills</option>
          <option value="Aluminum Section">Aluminum Section</option>
          <option value="Nets">Nets</option>
          <option value="Glass Work">Glass Work</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="grid-item">
        <label><i class="fas fa-tag"></i> Product Type / Model</label>
        <input type="text" id="itemType" placeholder="e.g., Sliding Window, Safety Door">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-home"></i> Location/Area</label>
        <select id="locationArea">
          <option value="">Select Location</option>
          <option value="Living Room">Living Room</option>
          <option value="Bedroom">Bedroom</option>
          <option value="Kitchen">Kitchen</option>
          <option value="Bathroom">Bathroom</option>
          <option value="Balcony">Balcony</option>
          <option value="Dining Room">Dining Room</option>
          <option value="Study Room">Study Room</option>
          <option value="Guest Room">Guest Room</option>
          <option value="Main Entrance">Main Entrance</option>
          <option value="Back Door">Back Door</option>
          <option value="Terrace">Terrace</option>
          <option value="Staircase">Staircase</option>
          <option value="Other">Other</option>
        </select>
      </div>
    </div>

    <div class="grid-container" style="margin-top: 15px;">
      <div class="grid-item">
        <label><i class="fas fa-arrows-alt-v"></i> Height (inches)</label>
        <input type="number" id="dimensionHeight" placeholder="0" step="0.01" oninput="calculateArea()">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-arrows-alt-h"></i> Width (inches)</label>
        <input type="number" id="dimensionWidth" placeholder="0" step="0.01" oninput="calculateArea()">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-expand"></i> Size (sq.ft.) <span style="color: #10b981; font-weight: 700;">●</span></label>
        <input type="number" id="area" placeholder="0.00" step="0.01" readonly
          style="background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-color: #86efac; font-weight: 600; color: #166534;">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-sort-numeric-up"></i> Quantity</label>
        <input type="number" id="quantity" placeholder="1" min="1" value="1" oninput="updatePricePreview()">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-rupee-sign"></i> Rate (₹ per sq.ft.)</label>
        <input type="number" id="rate" placeholder="0.00" step="0.01" oninput="updatePricePreview()">
      </div>
      <div class="grid-item">
        <label><i class="fas fa-calculator"></i> Total Amount (Live Preview)</label>
        <input type="text" id="livePrice" placeholder="₹0.00" readonly
          style="background: linear-gradient(135deg, #fef3c7, #fde68a); border-color: #fbbf24; font-weight: 700; color: #b45309; font-size: 16px; text-align: center;">
      </div>
    </div>

    <h2><i class="fas fa-window-maximize"></i> Frame & Sash Specifications</h2>
    <div class="frame-sash-grid">
      <div class="grid-item">
        <label>Frame Details</label>
        <textarea id="frameDesc" placeholder="Add Frame details" style="height: 80px;"></textarea>
      </div>
      <div class="grid-item">
        <label>Sash Details</label>
        <textarea id="sashDesc" placeholder="Add sash details" style="height: 80px;"></textarea>
      </div>
    </div>

    <h2><i class="fas fa-lock"></i> Lock Specifications</h2>
    <div class="grid-container">
      <div class="grid-item">
        <label><i class="fas fa-key"></i> Lock Type</label>
        <select id="lockType">
          <option value="">Select Lock Type</option>
          <option value="Multi-point Lock">Multi-point Lock</option>
          <option value="Single Point Lock">Single Point Lock</option>
          <option value="Mortise Lock">Mortise Lock</option>
          <option value="Cylinder Lock">Cylinder Lock</option>
          <option value="Sliding Lock">Sliding Lock</option>
          <option value="Deadbolt Lock">Deadbolt Lock</option>
          <option value="Smart Lock">Smart Lock</option>
          <option value="Cam Lock">Cam Lock</option>
          <option value="Padlock">Padlock</option>
          <option value="No Lock">No Lock</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="grid-item">
        <label>Description</label>
        <textarea id="lockDesc" placeholder="Additional lock details..."></textarea>
      </div>
    </div>

    <h2><i class="fas fa-glass-martini"></i> Glass Specifications</h2>
    <div class="grid-container">
      <div class="grid-item">
        <label><i class="fas fa-cube"></i> Glass Type</label>
        <select id="glassType">
          <option value="">Select Glass Type</option>
          <option value="Clear Glass">Clear Glass</option>
          <option value="Tempered Glass">Tempered Glass</option>
          <option value="Laminated Glass">Laminated Glass</option>
          <option value="Frosted Glass">Frosted Glass</option>
          <option value="Tinted Glass">Tinted Glass</option>
          <option value="Low-E Glass">Low-E Glass</option>
          <option value="Double Glazed">Double Glazed</option>
          <option value="Triple Glazed">Triple Glazed</option>
          <option value="Reflective Glass">Reflective Glass</option>
          <option value="Patterned Glass">Patterned Glass</option>
          <option value="Wired Glass">Wired Glass</option>
          <option value="Smart Glass">Smart Glass</option>
          <option value="Acoustic Glass">Acoustic Glass</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="grid-item">
        <label>Thickness (mm)</label>
        <input type="number" id="glassThickness" placeholder="e.g., 6mm">
      </div>
      <div class="grid-item">
        <label>Description</label>
        <textarea id="glassDesc" placeholder="Additional glass details..."></textarea>
      </div>
    </div>

    <div style="border-top: 2px solid #e5e7eb; padding-top: 20px; margin-top: 20px;">
      <h2><i class="fas fa-plus-circle"></i> Custom Fields</h2>
      <div id="customFieldsContainer"></div>
      <button class="btn btn-secondary" onclick="addCustomField()">
        <i class="fas fa-plus"></i> Add Custom Field
      </button>

      <div class="checkbox-container" style="margin-top: 15px;">
        <input type="checkbox" id="gstCheckbox">
        <label for="gstCheckbox"> Apply GST (18%)</label>
      </div>

      <div style="margin-top: 15px;">
        <button class="btn" onclick="addProduct()">
          <i class="fas fa-plus"></i> Add Item to Quotation
        </button>
        <button class="btn btn-secondary" onclick="generatePDF()">
          <i class="fas fa-download"></i> Download PDF
        </button>
      </div>
    </div>

    <div id="quotation" class="pdf-container">
      <div class="pdf-header">
        <div style="text-align: center; padding: 20px; border-bottom: 2px solid #104A8C; margin-bottom: 20px;">
          <h1 style="font-size: 28px; margin: 0; font-weight: bold; letter-spacing: 1px; color: #104A8C; font-family: Arial, sans-serif;">
            Aryan Window World
          </h1>
          <h3 style="font-size: 18px; margin: 5px 0 0 0; font-weight: normal; color: #333; font-family: Arial, sans-serif;">
            Professional Quotation
          </h3>
          <h3 style="font-size: 12px; margin: 5px 0 0 0; font-weight: normal; color: #333; font-family: Arial, sans-serif;">
            <b>GST Number: 24AQQPC8922K1ZI</b>
          </h3>
        </div>
        <div class="header-info">
          <div><strong>Date:</strong> <span id="outQuotationDate"></span></div>
          <div><strong>Quotation No:</strong> <span id="outQuotationNo"></span></div>
        </div>
      </div>

      <div class="section" id="customer-info">
        <h2>Customer Information</h2>
        <div class="customer-info-grid">
          <div class="info-item">
            <strong>Customer Name:</strong><br>
            <span id="outCustName">-</span>
          </div>
          <div class="info-item">
            <strong>Project Name:</strong><br>
            <span id="outProjectName">-</span>
          </div>
        </div>
      </div>

      <div id="products-section" class="section">
        <h2>Items</h2>
        <table id="itemsTable">
          <thead>
            <tr>
              <th>SR NO.</th>
              <th>PRODUCT SPECIFICATION</th>
              <th>Area</th>
              <th>Sq.ft</th>
              <th>QTY</th>
              <th>Unit RATE</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="section totals" id="totals-section">
        <table>
          <tr>
            <td><strong>Total Items</strong></td>
            <td id="totalItems">0</td>
          </tr>
          <tr>
            <td><strong>Total Squarefeet</strong></td>
            <td id="totalArea">0</td>
          </tr>
          <tr>
            <td><strong>Sub Total</strong></td>
            <td id="subtotal">₹0</td>
          </tr>
          <tr>
            <td><strong>GST (18%)</strong></td>
            <td id="taxes">₹0</td>
          </tr>
          <tr class="grand-total">
            <td><strong>Grand Total</strong></td>
            <td id="grandTotal">₹0</td>
          </tr>
        </table>
      </div>

      <div class="section" style="margin-top: 30px;">
        <h2>Terms & Conditions</h2>
        <ul class="terms-list">
          <li>The above quotation is valid for 30 days from the date of issue.</li>
          <li>Installation charges are included in the quoted price unless otherwise specified.</li>
          <li>Measurement will be taken after confirmation of order and final billing will be done based on actual measurement.</li>
          <li>Delivery time: 15-20 working days from the date of measurement and advance payment.</li>
          <li>Transportation and unloading charges are included within city limits.</li>
          <li>Site should be ready with necessary civil work completed before installation.</li>
          <li>Client to provide electricity and water facility at the installation site.</li>
          <li>Any additional accessories or modifications requested during installation will be charged separately.</li>
          <li>In case of cancellation, advance payment will be refunded after deduction of material and processing charges.</li>
          <li>Disputes, if any, are subject to local jurisdiction only.</li>
        </ul>
      </div>

      <footer>
        <strong>Thank You for Choosing Aryan Window World</strong><br>
        <small>Your Trust, Our Commitment to Excellence</small>
      </footer>
    </div>

    <script>
      // Authentication check
      function checkAuthentication() {
        if (sessionStorage.getItem('isAuthenticated') !== 'true') {
          window.location.href = 'login.html';
        } else {
          const username = sessionStorage.getItem('username') || 'User';
          document.getElementById('displayUsername').textContent = username;
        }
      }

      function handleLogout() {
        if (confirm('Are you sure you want to logout?')) {
          sessionStorage.removeItem('isAuthenticated');
          sessionStorage.removeItem('username');
          window.location.href = 'login.html';
        }
      }

      checkAuthentication();

      let productCount = 0;
      let subtotal = 0;
      let totalItems = 0;
      let totalArea = 0;
      let quoteCounter = 1;
      let customFieldCount = 0;

      const today = new Date();
      const day = String(today.getDate()).padStart(2, '0');
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const year = today.getFullYear();
      const formattedDate = `${day}-${month}-${year}`;
      document.getElementById('quotationDate').value = formattedDate;

      function calculateArea() {
        const height = parseFloat(document.getElementById('dimensionHeight').value) || 0;
        const width = parseFloat(document.getElementById('dimensionWidth').value) || 0;
        const areaInches = height * width;
        const areaSqFt = areaInches / 144;
        document.getElementById('area').value = areaSqFt > 0 ? areaSqFt.toFixed(2) : '';
        updatePricePreview();
      }

      function updatePricePreview() {
        const area = parseFloat(document.getElementById('area').value) || 0;
        const qty = parseInt(document.getElementById('quantity').value) || 0;
        const rate = parseFloat(document.getElementById('rate').value) || 0;

        if (area > 0 && qty > 0 && rate > 0) {
          const totalAmount = area * qty * rate;
          document.getElementById('livePrice').value = '₹' + totalAmount.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        } else {
          document.getElementById('livePrice').value = '₹0.00';
        }
      }

      function generateQuotationNumber() {
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, "0");
        const dd = String(today.getDate()).padStart(2, "0");
        const dateStr = `${yyyy}${mm}${dd}`;
        return `AWW-${dateStr}`;
      }

      function addCustomField() {
        customFieldCount++;
        const fieldId = `customField${customFieldCount}`;

        const fieldHTML = `
          <div class="custom-field-item" id="${fieldId}">
            <h4>
              <span><i class="fas fa-wrench"></i> Custom Field ${customFieldCount}</span>
              <button class="btn btn-danger" onclick="removeCustomField('${fieldId}')">
                <i class="fas fa-trash"></i> Remove
              </button>
            </h4>
            <div class="grid-container">
              <div class="grid-item">
                <label>Field Name</label>
                <input type="text" id="${fieldId}_name" placeholder="e.g., Hardware, Accessories">
              </div>
              <div class="grid-item">
                <label>Width (mm)</label>
                <input type="number" id="${fieldId}_width" placeholder="e.g., 100mm">
              </div>
              <div class="grid-item">
                <label>Height (mm)</label>
                <input type="number" id="${fieldId}_height" placeholder="e.g., 150mm">
              </div>
              <div class="grid-item">
                <label>Length (mm)</label>
                <input type="number" id="${fieldId}_length" placeholder="e.g., 200mm">
              </div>
              <div class="grid-item">
                <label>Description</label>
                <textarea id="${fieldId}_desc" placeholder="Additional details..."></textarea>
              </div>
            </div>
          </div>
        `;

        document.getElementById('customFieldsContainer').insertAdjacentHTML('beforeend', fieldHTML);
      }

      function removeCustomField(fieldId) {
        const field = document.getElementById(fieldId);
        if (field) {
          field.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => field.remove(), 300);
        }
      }

      function getCustomFieldsData() {
        const customFields = [];
        const container = document.getElementById('customFieldsContainer');
        const fieldItems = container.querySelectorAll('.custom-field-item');

        fieldItems.forEach(item => {
          const fieldId = item.id;
          const name = document.getElementById(`${fieldId}_name`)?.value.trim();
          const width = document.getElementById(`${fieldId}_width`)?.value.trim();
          const height = document.getElementById(`${fieldId}_height`)?.value.trim();
          const length = document.getElementById(`${fieldId}_length`)?.value.trim();
          const desc = document.getElementById(`${fieldId}_desc`)?.value.trim();

          if (name) {
            customFields.push({ name, width, height, length, desc });
          }
        });

        return customFields;
      }

      function addProduct() {
        const productCategory = document.getElementById("productCategory").value.trim();
        const itemType = document.getElementById("itemType").value.trim();
        const locationArea = document.getElementById("locationArea").value.trim();
        const area = parseFloat(document.getElementById("area").value || 0);
        const qty = parseInt(document.getElementById("quantity").value || 0);
        const rate = parseFloat(document.getElementById("rate").value || 0);

        if (!productCategory || !itemType || qty === 0 || area === 0 || rate === 0) {
          alert("Please fill in all required fields (Product Category, Product Type, Quantity, Size, and Rate)");
          return;
        }

        const totalItemArea = area * qty;
        const amount = totalItemArea * rate;

        let specDetails = "";
        const productTitle = productCategory === "Other" ? itemType : `${productCategory} - ${itemType}`;

        if (document.getElementById("frameDesc").value.trim()) {
          specDetails += `<br><b>Frame:</b> ${document.getElementById("frameDesc").value}`;
        }

        if (document.getElementById("sashDesc").value.trim()) {
          specDetails += `<br><b>Sash:</b> ${document.getElementById("sashDesc").value}`;
        }

        if (document.getElementById("lockType").value.trim()) {
          const lockType = document.getElementById("lockType").value;
          specDetails += `<br><b>Lock:</b> ${lockType}`;
          if (document.getElementById("lockDesc").value.trim()) {
            specDetails += `, ${document.getElementById("lockDesc").value}`;
          }
        }

        if (document.getElementById("glassType").value.trim()) {
          specDetails += `<br><b>Glass:</b> ${document.getElementById("glassType").value}`;
          if (document.getElementById("glassThickness").value.trim()) {
            specDetails += `, ${document.getElementById("glassThickness").value}`;
          }
          if (document.getElementById("glassDesc").value.trim()) {
            specDetails += `, ${document.getElementById("glassDesc").value}`;
          }
        }

        const customFields = getCustomFieldsData();
        customFields.forEach(field => {
          specDetails += `<br><b>${field.name}:</b>`;
          const details = [];
          if (field.width) details.push(`W:${field.width}`);
          if (field.height) details.push(`H:${field.height}`);
          if (field.length) details.push(`L:${field.length}`);
          if (details.length > 0) specDetails += ` ${details.join(', ')}`;
          if (field.desc) specDetails += `, ${field.desc}`;
        });

        productCount++;
        totalItems += qty;
        totalArea += totalItemArea;

        const table = document.getElementById("itemsTable").querySelector("tbody");
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><strong>${productCount}</strong></td>
          <td style="text-align: left; padding: 8px;"><strong>${productTitle}</strong>${specDetails}</td>
          <td><strong>${locationArea || '-'}</strong></td>
          <td>${area.toFixed(2)}</td>
          <td><strong>${qty}</strong></td>
          <td>₹${rate.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>
          <td><strong>₹${amount.toLocaleString('en-IN', { minimumFractionDigits: 2 })}</strong></td>
        `;
        table.appendChild(row);

        subtotal += amount;
        const applyGST = document.getElementById("gstCheckbox").checked;
        const taxes = applyGST ? subtotal * 0.18 : 0;
        const grandTotal = subtotal + taxes;

        document.getElementById("totalItems").innerText = totalItems;
        document.getElementById("totalArea").innerText = totalArea.toFixed(2);
        document.getElementById("subtotal").innerText = `₹${subtotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`;
        document.getElementById("taxes").innerText = `₹${taxes.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`;
        document.getElementById("grandTotal").innerText = `₹${grandTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`;

        document.getElementById("outCustName").innerText = document.getElementById("custName").value || "-";
        document.getElementById("outProjectName").innerText = document.getElementById("projectName").value || "-";

        if (productCount === 1) {
          const quoteNo = generateQuotationNumber();
          document.getElementById("outQuotationNo").innerText = quoteNo;
          quoteCounter++;
        }
        document.getElementById("outQuotationDate").innerText = document.getElementById("quotationDate").value;

        ["productCategory", "itemType", "locationArea", "dimensionHeight", "dimensionWidth", "area", "rate", "frameDesc",
          "sashDesc", "lockType", "lockDesc", "glassType", "glassThickness", "glassDesc"
        ].forEach(id => {
          const element = document.getElementById(id);
          if (element) element.value = "";
        });

        document.getElementById('quantity').value = '1';
        document.getElementById('livePrice').value = '₹0.00';
        document.getElementById('customFieldsContainer').innerHTML = '';
        customFieldCount = 0;

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Item Added!';
        btn.style.background = '#10b981';
        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.style.background = '';
        }, 2000);
      }

      async function generatePDF() {
        if (productCount === 0) {
          alert("Please add at least one product before generating PDF");
          return;
        }

        const btn = event.target;
        const originalText = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
        btn.disabled = true;

        try {
          const { jsPDF } = window.jspdf;
          const element = document.getElementById("quotation");
          element.classList.add('loading');

          const canvas = await html2canvas(element, {
            scale: 2,
            useCORS: true,
            allowTaint: true,
            backgroundColor: '#ffffff'
          });

          const imgData = canvas.toDataURL("image/jpeg", 0.8);
          const pdf = new jsPDF("p", "mm", "a4");
          const imgProps = pdf.getImageProperties(imgData);
          const pdfWidth = 210;
          const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
          let heightLeft = pdfHeight;
          let position = 0;

          pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, pdfHeight, 'FAST');
          heightLeft -= 297;

          while (heightLeft > 0) {
            position = heightLeft - pdfHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'JPEG', 0, position, pdfWidth, pdfHeight, 'FAST');
            heightLeft -= 297;
          }

          const customerName = document.getElementById("custName").value || "Customer";
          const quotationNo = document.getElementById("outQuotationNo").innerText;
          const filename = `${customerName.replace(/\s+/g, '_')}_Quotation_${quotationNo}.pdf`;

          pdf.save(filename);
          element.classList.remove('loading');

          btn.innerHTML = '<i class="fas fa-check"></i> PDF Downloaded!';
          btn.style.background = '#10b981';

        } catch (error) {
          console.error('Error generating PDF:', error);
          alert('Error generating PDF. Please try again.');
          btn.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error!';
          btn.style.background = '#ef4444';
        }

        setTimeout(() => {
          btn.innerHTML = originalText;
          btn.style.background = '';
          btn.disabled = false;
        }, 3000);
      }

      document.getElementById('locationArea').addEventListener('change', function () {
        if (this.value === 'Other') {
          const customLocation = prompt('Please enter the location:');
          if (customLocation && customLocation.trim()) {
            const option = document.createElement('option');
            option.value = customLocation.trim();
            option.textContent = customLocation.trim();
            option.selected = true;
            const otherOption = this.querySelector('option[value="Other"]');
            this.insertBefore(option, otherOption);
          } else {
            this.value = '';
          }
        }
      });

      document.addEventListener('DOMContentLoaded', function () {
        document.getElementById('quantity').value = '1';

        ['area', 'rate'].forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('blur', function () {
              if (this.value) {
                this.value = parseFloat(this.value).toFixed(2);
              }
            });
          }
        });

        ['custName', 'projectName'].forEach(id => {
          const input = document.getElementById(id);
          if (input) {
            input.addEventListener('input', function () {
              const outputId = 'out' + id.charAt(0).toUpperCase() + id.slice(1);
              const output = document.getElementById(outputId);
              if (output) {
                output.innerText = this.value || '-';
              }
            });
          }
        });

        document.getElementById('lockType').addEventListener('change', function () {
          if (this.value === 'Other') {
            const customLock = prompt('Please enter the lock type:');
            if (customLock && customLock.trim()) {
              const option = document.createElement('option');
              option.value = customLock.trim();
              option.textContent = customLock.trim();
              option.selected = true;
              const otherOption = this.querySelector('option[value="Other"]');
              this.insertBefore(option, otherOption);
            } else {
              this.value = '';
            }
          }
        });

        document.getElementById('glassType').addEventListener('change', function () {
          if (this.value === 'Other') {
            const customGlass = prompt('Please enter the glass type:');
            if (customGlass && customGlass.trim()) {
              const option = document.createElement('option');
              option.value = customGlass.trim();
              option.textContent = customGlass.trim();
              option.selected = true;
              const otherOption = this.querySelector('option[value="Other"]');
              this.insertBefore(option, otherOption);
            } else {
              this.value = '';
            }
          }
        });

        document.getElementById('gstCheckbox').addEventListener('change', function () {
          if (subtotal > 0) {
            const taxes = this.checked ? subtotal * 0.18 : 0;
            const grandTotal = subtotal + taxes;
            document.getElementById("taxes").innerText = `₹${taxes.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`;
            document.getElementById("grandTotal").innerText = `₹${grandTotal.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`;
          }
        });
      });
    </script>

</body>

</html>